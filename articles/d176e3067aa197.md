---
title: "Ajax通信を使用した静的サイトでお知らせ記事とページネーションを実装する"
emoji: "🔖"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: [HTML, CSS, JavaScript]
published: false
---

HTML、CSS、JavaScript のみの静的サイト制作案件で、JSON データから取得したコンテンツ の一覧表示とページネーションを実装した時の備忘録

## HTML とコンテンツ管理用の JSON ファイル

- JSON データから取得したデータをもとに要素を生成するための HTML

```html:index.html
<div class="newsList" id="newsList"></div>
<div class="pagination" id="pagination"></div>
```

- コンテンツの管理用の JSON ファイル

```js:data/news.json
[
    {
        "date": "2025-00-00",
        "category": "ニュースのカテゴリ",
        "title": "ニュースのタイトル",
        "link": "#"
    },
    {
        "date": "2025-00-00",
        "category": "ニュースのカテゴリ",
        "title": "ニュースのタイトル",
        "link": "#"
    },
]
```

## コンテンツ一覧を表示させる

一覧を表示させるための JavaScript
:::details main.js

```js
document.addEventListener("DOMContentLoaded", function () {
  const newsList = document.getElementById("newsList");
  const pagination = document.getElementById("pagination");
  const ITEMS_PER_PAGE = 5;
  const url = "data/news.json";

  async function fetchData(url) {
    try {
      const response = await fetch(url);
      if (!response.ok) {
        throw new Error(
          `Network response was not ok: ${response.status} ${response.statusText}`
        );
      }
      return await response.json();
    } catch (error) {
      console.error("Error fetching data:", error);
      displayError("データの取得に失敗しました。");
      return null;
    }
  }

  function displayError(message) {
    newsList.innerHTML = `<p class="error">${message}</p>`;
  }

  function renderNewsList(newsData, page) {
    newsList.innerHTML = "";

    const startIndex = (page - 1) * ITEMS_PER_PAGE;
    const endIndex = startIndex + ITEMS_PER_PAGE;
    const paginatedData = newsData.slice(startIndex, endIndex);

    paginatedData.forEach((item) => {
      const newsItem = document.createElement("a");
      newsItem.href = item.link;
      newsItem.className = "item";
      if (item.external) {
        newsItem.target = "_blank";
        newsItem.classList.add("external");
      }

      newsItem.innerHTML = `
              <p class="meta">
                <time class="date" datetime="${item.date}">${item.date.replace(
        /-/g,
        "."
      )}</time>
                <span class="category">${item.category}</span>
              </p>
              <h3 class="title">
                ${item.title}
                ${
                  item.external
                    ? `
                  <span role="img" aria-hidden="true">
                    <svg
                      role="img"
                      aria-hidden="true"
                      width="24"
                      height="24"
                      viewBox="0 0 24 24"
                      fill="none"
                    >
                      <path
                        d="M5 21C4.45 21 3.97917 20.8042 3.5875 20.4125C3.19583 20.0208 3 19.55 3 19V5C3 4.45 3.19583 3.97917 3.5875 3.5875C3.97917 3.19583 4.45 3 5 3H12V5H5V19H19V12H21V19C21 19.55 20.8042 20.0208 20.4125 20.4125C20.0208 20.8042 19.55 21 19 21H5ZM9.7 15.7L8.3 14.3L17.6 5H14V3H21V10H19V6.4L9.7 15.7Z"
                        fill="#E14D21"
                      />
                    </svg>
                  </span>`
                    : ""
                }
              </h3>
          `;

      newsList.appendChild(newsItem);
    });
  }

  function renderPagination(newsData, currentPage, onPageChange) {
    pagination.innerHTML = "";
    const totalPages = Math.ceil(newsData.length / ITEMS_PER_PAGE);

    const createButton = (label, disabled, onClick) => {
      const button = document.createElement("button");
      button.textContent = label;
      button.disabled = disabled;
      button.addEventListener("click", onClick);
      return button;
    };

    // Previous button
    pagination.appendChild(
      createButton("前へ", currentPage === 1, () => onPageChange(currentPage - 1))
    );

    // Page buttons
    for (let i = 1; i <= totalPages; i++) {
      if (i === 1 || i === totalPages || (i >= currentPage - 1 && i <= currentPage + 1)) {
        const button = createButton(i, i === currentPage, () => onPageChange(i));
        if (i === currentPage) button.classList.add("active");
        pagination.appendChild(button);
      } else if (
        (i === currentPage - 2 || i === currentPage + 2) &&
        pagination.lastChild.textContent !== "..."
      ) {
        const dots = document.createElement("span");
        dots.textContent = "...";
        pagination.appendChild(dots);
      }
    }

    // Next button
    pagination.appendChild(
      createButton("次へ", currentPage === totalPages, () => onPageChange(currentPage + 1))
    );
  }

  async function initialize() {
    const data = await fetchData(url);
    if (!data) return;

    let currentPage = 1;

    const onPageChange = (page) => {
      currentPage = page;
      renderNewsList(data, currentPage);
      renderPagination(data, currentPage, onPageChange);
    };

    renderNewsList(data, currentPage);
    renderPagination(data, currentPage, onPageChange);
  }

  initialize();
});
```

:::

- `inner.HTML`プロパティで生成した HTML を表示させる要素を取得（`document.getElementById`）
- 1 ページに表示させるコンテンツの上限（`ITEMS_PER_PAGE`）
- JSON データのパス（`data/news.json`）

```js
const newsList = document.getElementById("newsList");
const pagination = document.getElementById("pagination");
const ITEMS_PER_PAGE = 5;
const url = "data/news.json";
```

- fetch 関数を使用して、news.json ファイルから非同期でデータを取得します。この関数は Promise を返し、リクエストが成功すると Response オブジェクトが返されます。
- 取得した Response オブジェクトを response.json()メソッドで JSON 形式に変換します。このメソッドも非同期処理であり、Promise を返します。
- 変換された JSON データを data という変数に格納し、renderNewsList 関数と renderPagination 関数を呼び出して、ニュースリストとページネーションを描画します。

```js
async function fetchData(url) {
  try {
    const response = await fetch(url);
    if (!response.ok) {
      throw new Error(
        `Network response was not ok: ${response.status} ${response.statusText}`
      );
    }
    return await response.json();
  } catch (error) {
    console.error("Error fetching data:", error);
    displayError("データの取得に失敗しました。");
    return null;
  }
}
```
