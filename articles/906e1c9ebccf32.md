---
title: "Next.jsã§commitæ™‚ã«ESLintã¨Prettierã‚’å®Ÿè¡Œã™ã‚‹"
emoji: "ğŸ˜ˆ"
type: "tech" ## tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [nextjs, prettier, eslint]
published: true
---

## ã¯ã˜ã‚ã«

å€‹äººç”¨ã®ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ã« Husky ã‚’ä½¿ç”¨ã—ã¦ã€ã‚³ãƒŸãƒƒãƒˆæ™‚ã« ESLint ã¨ Prettier ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã‚ˆã†ã«ã—ãŸã®ã§å‚™å¿˜éŒ²ã¨ã—ã¦æ®‹ã™ã€‚

## ç’°å¢ƒ

- Next.js 13.5.2(App Router)
- TypeScript 5.1.6
- Tailwind CSS 3.3.3
- ESLint 8.47.0
- Prettier 3.0.2

## ESLint ã®å°å…¥

æœ€åˆã® Next.js ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚ã«ã€ŒWould you like to use ESLint with this project?ã€ã§ â€Yesâ€ ã¨ç­”ãˆã¦ã„ã‚‹ã®ã§ ESLint ã¯è‡ªå‹•çš„ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã€‚

ãŸã ã€TypeScriptç”¨ã®ESLintãŒå«ã¾ã‚Œã¦ã„ãªã„ã®ã§ä¸‹è¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã€‚

```shell
npm install @typescript-eslint/eslint-plugin
```

ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®`.eslintrc.json`ã«ã€ä¸‹è¨˜ã‚’è¿½åŠ ã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’æœ‰åŠ¹åŒ–ã™ã‚‹ã€‚

```json:.eslintrc.json
{
  "extends": ["plugin:@typescript-eslint/recommended", "next/core-web-vitals"]
}
```

`package.json` ã« `scripts` ã‚’è¿½åŠ ã™ã‚‹

```json:package.json
 "scripts": {
    "lint": "next lint",
  "lint:fix": "next lint --fix",
  },
```

## Prettier ã®å°å…¥

Prettierã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã€‚

```shell
npm install prettier
```

local keymap = vim.keymap

â€»Tailwind CSS ã®ã‚¯ãƒ©ã‚¹åã‚’ä¸¦ã³æ›¿ãˆã‚‹ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’å…¥ã‚Œã‚‹å ´åˆ

```shell
npm install prettier-plugin-tailwindcss
```

`.prettierrc`ã« prettier ã®ãƒ«ãƒ¼ãƒ«ã¨ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®è¨­å®šã‚’è¡Œã†ã€‚
(ãƒ«ãƒ¼ãƒ«ã®è©³ç´°ã¯[ã“ã¡ã‚‰](https://prettier.io/docs/en/options.html))

```json:.prettierrc
{
  "tabWidth": 2,
  "printWidth": 90,
  "trailingComma": "es5",
  "semi": true,
  "singleQuote": true,
  "plugins": ["prettier-plugin-tailwindcss"]
}

```

Prettier ã¨ ESlint ã§ç«¶åˆã™ã‚‹ãƒ«ãƒ¼ãƒ«ã‚’ã‚ªãƒ•ã«ã™ã‚‹

```shell
npm install eslint-config-prettier
```

`.eslintrc.json` ã®è¨­å®šã‚’è¿½åŠ ã™ã‚‹ã€‚

```json:.eslintrc.json
{
  "extends": [
    "plugin:@typescript-eslint/recommended",
    "next/core-web-vitals",
    "prettier"
  ]
}
```

package.json ã«`scripts`ã‚’è¿½åŠ ã™ã‚‹

```json:package.json
 "scripts": {
    "format": "prettier --write --ignore-path .gitignore './**/*.{js,jsx,ts,tsx,json,css}' --plugin=prettier-plugin-tailwindcss"
  },
```

## Husky ã¨ lint-staged ã®å°å…¥

husky ã¯`pre-commit`ï¼ˆã‚³ãƒŸãƒƒãƒˆå‰ï¼‰ã‚„`pre-push`ï¼ˆãƒ—ãƒƒã‚·ãƒ¥å‰ï¼‰ã«`package.json`ã«è¨˜è¿°ã—ãŸã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ã€‚

lint-staged ã¯ã€Git ã§ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°(add)ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã«å¯¾ã—ã¦ã®ã¿ ESLint ã‚„ Prettier ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã‚’ç›®çš„ã¨ã—ãŸã‚‚ã®ã€‚

ã‚³ãƒŸãƒƒãƒˆå‰ã«å®Ÿè¡Œã•ã›ã‚‹

```shell
npm install husky lint-staged
```

æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã€è¨­å®šã®é››å½¢ãŒè¨˜è¿°ã•ã‚ŒãŸ`.husky`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ç”Ÿæˆã™ã‚‹ã€‚

```shell
npm husky install
```

`package.json`ã«ã‚³ãƒãƒ³ãƒ‰ã‚’è¨­å®šã™ã‚‹ã€‚

ã“ã®ã‚³ãƒãƒ³ãƒ‰ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã“ã¨ã«ã‚ˆã£ã¦ã€ã‚¹ãƒ†ãƒ¼ã‚¸ä¸Šã®ãƒ•ã‚¡ã‚¤ãƒ«ã«å¯¾ã—ã¦ ESLint ã‚„ Prettier ã‚’å®Ÿè¡Œã™ã‚‹äº‹ãŒã§ãã‚‹ã€‚

```json:package.json
"devDependencies": {
    // çœç•¥
  },
  "lint-staged": {
    "*.{ts,tsx}": [
      "npm run lint",
      "npm run format",
      "npm run lint:fix"
    ]
  }
```

`pre-commit`ï¼ˆã‚³ãƒŸãƒƒãƒˆå‰ï¼‰ã‚’ãƒˆãƒªã‚¬ãƒ¼ã«ã€å…ˆã»ã©è¨­å®šã—ãŸ`lint-staged`ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã«ã€`.husky/pre-commit`ã«è¨­å®šã‚’è¨˜è¿°ã™ã‚‹ã€‚

ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«æ¬¡ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã™ã‚‹ã€‚

```shell
touch .husky/pre-commit
```

`.husky/pre-commit`ãƒ•ã‚¡ã‚¤ãƒ«ã«å®Ÿè¡Œã—ãŸã„å‡¦ç†(`npm run lint-staged`)ã‚’è¨˜è¿°

```shell
##!/bin/sh
. "$(dirname "$0")/_/husky.sh"

npm run lint-staged
```

æ¬¡ã«ã€`.lintstagedrc.js`ã§`lint-staged`ã®è¨­å®šã‚’è¨˜è¿°ã™ã‚‹ã€‚([å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://nextjs.org/docs/app/building-your-application/configuring/eslint))
ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«`.lintstagedrc.js`ã‚’ä½œæˆ

```js:.lintstagedrc.js
const path = require('path');

const buildEslintCommand = (filenames) =>
  `next lint --fix --file ${filenames
    .map((f) => path.relative(process.cwd(), f))
    .join(' --file ')}`;

module.exports = {
  '*.{js,jsx,ts,tsx}': [buildEslintCommand, 'prettier --write'],
};

```

ã“ã‚Œã§ã€commit å‰ã«ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã«å¯¾ã—ã¦ ESLint ã¨ Prettier ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

è¿½åŠ ã§ã€ãƒ—ãƒƒã‚·ãƒ¥å‰ã«å‹ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œã•ã›ãŸã„ã®ã§
åŒã˜ã‚ˆã†ã«ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«`.husky/pre-push`ã‚’ä½œæˆã—ã¦è¨­å®šã‚’è¨˜è¿°ã™ã‚‹ã€‚

```shell
touch .husky/pre-push
```

`.husky/pre-push`ãƒ•ã‚¡ã‚¤ãƒ«ã¨`package.json`ã®`scripts`ã«å®Ÿè¡Œã—ãŸã„å‡¦ç†(`npm run check-types`)ã‚’è¨˜è¿°ã™ã‚‹ã€‚

```shell
##!/bin/sh
. "$(dirname "$0")/_/husky.sh"

npm run check-types
```

`package.json`ã«`scripts`ã‚’è¿½åŠ ã™ã‚‹ã€‚

```json:package.json
 "scripts": {
    "check-types": "tsc --noEmit",
  },
```

ã‚¹ã‚¯ãƒªãƒ—ãƒˆã«å®Ÿè¡Œæ¨©é™ã‚’ä¸ãˆã‚Œã°çµ‚äº† ğŸ‘

```shell
chmod a+x .husky/pre-push
chmod a+x .husky/pre-commit
```
